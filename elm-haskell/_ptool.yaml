description: Simple Elm frontend with Haskell/Servant backend

template-values:
  elm_copyright: |
    --------------------------------------------------
    -- Copyright (C) 2017, All rights reserved.
    --------------------------------------------------
  hs_copyright: |
    --------------------------------------------------
    -- Copyright (C) 2017, All rights reserved.
    --------------------------------------------------
  lib_dependencies:
  - aeson
  - base >= 4.7 && < 5
  - elm-export
  - servant
  - template-haskell
  - time
  - vcs-revision
  lib_exposed_modules:
  - API
  - Types
  - VersionInfo
  app_dependencies:
  - base >= 4.7 && < 5
  - optparse-applicative
  - servant-server
  - time
  - wai
  - wai-cors
  - wai-logger
  - warp
  app_other_modules:
  - App
  - CommandLine
  - Types
  - Util
  test_dependencies:
  - base >= 4.7 && < 5
  - hspec
  codegen_dependencies:
  - base >= 4.7 && < 5
  - directory
  - elm-export
  - optparse-applicative
  - optparse-text
  - servant-elm
  - text

template-filters:
  child_module_name: "lambda ctx, s, module_suffix=\"\": \"{}{}.{}\".format(ctx.module_name, module_suffix, s)"
  to_env_project_name: "lambda ctx, s: \"_\".join(map(lambda s: s.upper(), ctx.tokenize(s)))"
  to_module_name: "lambda ctx, s: \"\".join(map(lambda s: s.title(), ctx.tokenize(s)))"
  to_paths_module_name: "lambda ctx, s: \"Paths_{}\".format(\"_\".join(map(lambda s: s.lower(), ctx.tokenize(s))))"

template-globals:
  env_project_name: "{{ project_name | to_env_project_name }}"
  module_name: "{{ project_name | to_module_name }}"
  paths_module_name: "{{ project_name | to_paths_module_name }}"

files:
- README.md
- path: ../_shared/LICENSE
  output-path: LICENSE
- path: ../_shared/elm/.gitignore
  output-path: frontend/.gitignore
- .env.template
- path: .env.template
  output-path: .env
- .gitignore
- path: elm-package.json
  output-path: frontend/elm-package.json
- path: ../_shared/elm/package.json
  output-path: frontend/package.json
- path: App.elm
  output-path: frontend/src/App.elm
- path: ../_shared/elm/src/favicon.ico
  output-path: frontend/src/favicon.ico
  preprocess: false
- path: ../_shared/elm/src/index.html
  output-path: frontend/src/index.html
- path: index.js
  output-path: frontend/src/index.js
- path: ../_shared/elm/src/logo.svg
  output-path: frontend/src/logo.svg
  preprocess: false
- path: ../_shared/elm/src/main.css
  output-path: frontend/src/main.css
- path: Codegen.elm
  output-path: frontend/src/{{module_name}}/Codegen.elm
- path: Decode.elm
  output-path: frontend/src/{{module_name}}/Decode.elm
- path: Types.elm
  output-path: frontend/src/{{module_name}}/Types.elm
- path: Util.elm
  output-path: frontend/src/{{module_name}}/Util.elm
- path: ../_shared/elm/tests/Tests.elm
  output-path: frontend/tests/Tests.elm
- path: ../_shared/elm/tests/elm-package.json
  output-path: frontend/tests/elm-package.json
- path: ../_shared/haskell/.gitignore
  output-path: backend/.gitignore
- path: stack.yaml
  output-path: backend/stack.yaml
- path: ../_shared/haskell/Setup.hs
  output-path: backend/Setup.hs
- path: ../_shared/haskell/project.cabal
  output-path: backend/{{project_name}}.cabal
- path: app_Main.hs
  output-path: backend/app/Main.hs
- path: app_App.hs
  output-path: backend/app/{{module_name}}App/App.hs
- path: app_CommandLine.hs
  output-path: backend/app/{{module_name}}App/CommandLine.hs
- path: app_Types.hs
  output-path: backend/app/{{module_name}}App/Types.hs
- path: app_Util.hs
  output-path: backend/app/{{module_name}}App/Util.hs
- path: lib_API.hs
  output-path: backend/lib/{{module_name}}/API.hs
- path: lib_Types.hs
  output-path: backend/lib/{{module_name}}/Types.hs
- path: lib_VersionInfo.hs
  output-path: backend/lib/{{module_name}}/VersionInfo.hs
- path: ../_shared/haskell/lib/Project.hs
  output-path: backend/lib/{{module_name}}.hs
- path: ../_shared/haskell/test/Spec.hs
  output-path: backend/test/Spec.hs
- path: ../_shared/haskell/test/ProjectSpec.hs
  output-path: backend/test/{{module_name}}Spec.hs
- path: codegen_CommandLine.hs
  output-path: backend/codegen/{{module_name}}Codegen/CommandLine.hs
- path: codegen_Main.hs
  output-path: backend/codegen/Main.hs
- script/backend
- script/codegen
- script/frontend

commands:
- git init
- git remote add origin {{ project_name | git_url(git_server) }}
- git config user.name "{{author}}"
- git config user.email "{{author_email}}"
- git add .
- git-execute-attribute:
    path: script/backend
- git-execute-attribute:
    path: script/codegen
- git-execute-attribute:
    path: script/frontend
- git-symlink:
    source-path: LICENSE
    target-path: backend/LICENSE
- git-symlink:
    source-path: README.md
    target-path: backend/README.md
